# A SUARA Implementation using SimGrid

[SUARA: A scalable universal allreduce communication algorithm for
acceleration of parallel deep learning applications](https://www.sciencedirect.com/science/article/pii/S0743731523001375) 

Authors: Emin Nuriyev , Ravi Reddy Manumachu, Samar Aseeri, Mahendra K. Verma, Alexey L. Lastovetsky


## 1. Directory Structure

```
NHPC_Project/
├── network_configuration_estimation/
│   ├── platform.xml                   
│   ├── linear_allreduce.c             
│   ├── run_linear_allreduce_series.sh        
│   ├── analyze_regression.py 
│   ├── plot_m_vs_t.py           
│   └── points_for_viz.csv            
├── platform.xml                       
└── hierarchical_allreduce.c           
```

## 2. Brief Description of Each File

| **File Name** | **Type** | **Description** |
|----------------|-----------|-----------------|
| `platform.xml` | XML | The SimGrid platform file defining the network topology. Refer: [SimGrid Platform Examples](https://simgrid.org/doc/latest/Platform_examples.html) |
| `linear_allreduce.c` | C (MPI) | Implements the Linear Chain Allreduce collective using sequential `MPI_Send` and `MPI_Recv` operations. Contains logic for data perturbation, timing, and calculating the regression variables ($X_1, X_2, X_3$). |
| `run_linear_allreduce_series.sh` | Bash Script | Automation script used to compile `linear_allreduce.c`, execute the resulting binary multiple times with varying process numbers (`-np 4, 8, 16, etc.`), and aggregate the raw CSV output into a single data file (`points_for_viz.csv`). |
| `points_for_viz.csv` | Data (CSV) | The combined output file generated by the bash script. It contains the raw benchmark results, with columns for Process Count (P), Message Size (m), Execution Time (T), and the calculated regression variables (X1, X2, X3). |
| `generate_analyze_regression.py` | Python | This script reads the aggregated data from the CSV, applies multiple linear regression using `statsmodels`, and fits the cost model $T \approx \alpha \cdot X_1 + \beta \cdot X_2 + \gamma \cdot X_3$ to find the estimated network parameters ($\alpha, \beta, \gamma$). |
| `plot_m_vs_t.py` | Python | Script used to visualize the raw performance data. It plots the relationship between Total Message Size (m) on the x-axis and Total Execution Time (T) on the y-axis. |
| `hierarchical_allreduce.c` | C (MPI) | Contains the code for running Hierarchical Allreduce (e.g., in a Grid format). |

---

## 3. File Execution

Follow these steps to generate the performance data, analyze the network parameters, and visualize the results for the **Linear Chain Allreduce** algorithm.


### **&rarr; Linear Allreduce For Network Parameter Estimation**

Use the script and C file in the `network_configuration_estimation` subdirectory to generate performance data across multiple process counts.

**Compile the C code:**  
Compile the custom Allreduce implementation for use with SMPI.

```bash
smpicc linear_allreduce.c 
````

**Generate Data for the Series:**
Use the provided bash script to automate data collection across different process counts and message sizes.
The script executes the compiled binary (`a.out`) for a range of processes and aggregates the output into a csv (`points_for_viz.csv`).

```bash
./run_linear_allreduce_series.sh
```

---

### **&rarr; Linear Allreduce Analysis and Parameter Estimation**

**Visualize Results:**
Use the plotting script to visualize the Time vs. Message Size relationship.

```bash
python3 plot_m_vs_t.py
```

**Analyze Regression:**
Run the Python script to perform the Multiple Linear Regression analysis on the gathered data to determine the network parameters ($\alpha, \beta, \gamma$).

```bash
python3 analyze_regression.py
```

**Result:**
The script will output the estimated values for:

* $\alpha$ → Latency
* $\beta$ → Inverse Bandwidth
* $\gamma$ → Computation Cost

---

### **&rarr; Hierarchical Allreduce Execution**

This phase involves compiling and running the separate hierarchical implementation.
Commands below are executed from the **root directory** of the project, assuming `platform.xml` is passed via the command line.

**Compile the Hierarchical code:**
```bash
smpicc hierarchical_allreduce.c
smpirun -n <P> -platform platform.xml ./a.out <Pc>
```

**Execute the Hierarchical Allreduce:**
Run the simulation with a specified number of processes (`<P>`) using the Fat Tree or Grid topology defined in `platform.xml`. The `<Pc>` argument must be between 1 and (`<P>`) and defines the number of columns in the grid.




